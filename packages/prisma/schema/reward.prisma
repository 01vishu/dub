enum EventType {
  click
  lead
  sale
}

enum RewardStructure {
  percentage
  flat
}

model Reward {
  id          String         @id @default(cuid())
  programId   String
  name        String?
  description String?
  event       EventType
  type        RewardStructure @default(percentage)
  amount      Int            @default(0)
  maxDuration Int? // in months (0 -> not recurring, null -> infinite)
  maxAmount   Int? // how much a partner can receive payouts (in cents)
  default     Boolean        @default(false)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  program          Program             @relation(fields: [programId], references: [id], onDelete: Cascade)
  partners         PartnerReward[]
  clickEnrollments ProgramEnrollment[] @relation("ClickRewardEnrollments")
  leadEnrollments  ProgramEnrollment[] @relation("LeadRewardEnrollments")
  saleEnrollments  ProgramEnrollment[] @relation("SaleRewardEnrollments")

  @@index([programId, event])
  @@index(event) // used in aggregate-clicks cron job
}

// TODO: Remove this table after https://github.com/dubinc/dub/pull/2504 merges
model PartnerReward {
  id                  String @id @default(cuid())
  programEnrollmentId String
  rewardId            String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reward Reward @relation(fields: [rewardId], references: [id], onDelete: Cascade)

  @@unique([programEnrollmentId, rewardId])
  @@index(rewardId)
}
